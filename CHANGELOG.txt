//$Id: CHANGELOG.txt,v 1.1.6.51 2008/07/08 02:17:31 karens Exp $
Date Module 5.2
=================

Version 5.2-dev
=================

Version 5.2-rc2
===============

New Features

- #272551 Add option to expand or collapse repeating date options.
- #261610 Add option for the date theme to display only a single date if $node->date_id is set.
- #187599 Backport content_generate so Devel module can create data for CCK fields when creating nodes.
- #233415 separate ical retrieval and parser so other modules like feedapi can use the parser alone.
- Update date copy to convert either version 1 or version 2 Event nodes.
- Trigger js timezone detection on user edit form and registration form.

Timezone handling

- #279051 Fix postgres timezone test.
- Centralize method of setting timezone adjustments for filters and arguments.
- Fix PHP4 handler for date_timezone_set() which was incorrectly altering the timestamp value.
- #269834 Add timezone adjustment to PHP4 date_format() wrapper.
- Rework PHP4 date handling to avoid any use of date() or mktime(), which may inject an incorrect timezone offset.
- Get rid of the adodb method of computing the gmt offset for PHP4 and use the date_offset_get() computation.
- Fix use of wrong value for timezone in repeating dates.
- #270267 Remove timezone_identifiers_list() in the install file from the global space.
- Change method of showing multiple values with timezones on forms and show them in every instance. 
  This is to simplify the processing and avoid errors when trying to apply the timezone in the 
  first item to all other items.
- Backport the improved sql handler (with better timezone handling) from the D6 version.
- #270304 Timezone was not getting saved in field and user account.
- Omit the timezone from the process to store the current date parts in the form.
- More work to ensure all the right timezone files are available in installations and updates.
- Fix critical typo in date_get_timezone() that set the timezone to the site timezone even if it isn't right.
- Display the timezone when that format is selected, and pull the timezone out of format strings.
- Change method of getting translations for all timezones into the install file.
- Make sure anonymous users don't see timezone message.
- Fix critical flaw in the new timezone list handling that was creating an invalid array.
- Prepare for proposed core timezone handling from #11077 by getting rid of deprecated timezones and adding in js timezone name detection.
- Rework default timezone handling to force a valid date even when timezones are not set to get rid of numerous installation and operational errors caused by invalid date objects.
- Update site timezone offset during cron and user offset during login to make sure that modules that rely on the timezone offset  have current information to process when the offset changes.
- Clean up timezone handling in date repeat logic.
- #234360 fix date_server_zone_adj() function.

Other

- #277420 Add test to Views filter so it won't try to process a 5.1 style filter value, which would break.
- Simplify Views handling by using new date_sql_hander() function that was backported from D6.
- Add week handling and granularity tests to date_sql_handler().
- Set date prefix on date navigation css classes.
- Fix computation of 'N' in PHP4 date_format() wrapper to get date_week() working right in PHP4.
- #275213 Wrong year value in date_week_range().
- #274403 Fix typo in date_hours().
- #272110 Alter css so that from/to dates can float next to each other.
- #275490 Remove orphaned punctuation at beginning of string in date_limit_format().
- #277549 Make sure no repeats are created if no start date was set.
- If there's no offset field, don't try to add it to view.
- #272523 Fix error in PHP4 wrapper code that kept date_modify from working reliably.
- #273344 Make sure incomplete Date Popup values get converted into complete dates.
- #276544 Rework system for handling timezone in date theme.
- Rework Views filters, especially the 'now' and '+1' filters.
- #251994 Add code to adjust NOW() by a number of seconds to allow NOW() to be the beginning of the day.
- Was using wrong value for field type in Views and losing conversion to the right date value.
- Remove as many dependencies as possible from install files and auto-enable necessary modules.
- Date Popup was not handling empty non-required values correctly and they were defaulting to current date.
- #273727 Small fixes to field settings validation.
- #248338 and #254819 clean up date_limit_format() to better handle punctuation and escaped letters.
- The jQuery calendar requires year, month, and day or it won't work, add validation for that in the settings.
- #270358 Fix handling of year-only or month-only text fields to save the right values.
- Remove unneeded hook_form_alter() used to fix radio values for granularity.
- Make sure granularity is in correct format before setting value in field settings form.
- Clean up Date popup validation.
- Fix undefined indexes in date_repeat_calc.inc.
- #232959 Get rid of unwanted scrollbars in date fieldsets using trick discovered by threexk.
- #251479 Keep pathauto from trying to compute date value for node type without a date.
- Add a is_string() test to the date_is_valid() function.
- Date_fuzzy_date was not handling input from date_popup or date_text in the right way.
- #260611 Replace substr with drupal_substr where used to get month and day abbreviations.
- The granularity options were not saved correctly by CCK when provided as checkboxes, change them back to a select widget and fix the bad values in an update.
- Have the date_text element handle its own format description instead of doing it in the Date module.
- Empty values were getting saved.
- #257353 No need for format description when using select widget.
- #270626 Fix documentation errors that use create_date() instead of date_create().
- Fix computation of week range computed from views arguments.
- #263377 Re-fix patch that I broke in later commit.
- Comment out RRULE temporarily until repeating rules are fixed.
- Change expected form values to match latest changes in CCK admin form.
- #261631 No longer using $append, so get rid of it.
- #264208 Fix fatal typo in date_limit_format() regex.
- #263377 Fix bad arguments for date_formatter_process.
- #263078 Fix error in setting up db session info that was triggering the MYSQL code for POSTGRES.
- Add calendar week calculations to the Date API so we can move them out of Calendar module to be able to use them in any date application.
- #258688 fix typo in file name that used the D6 content module naming convention.
- #130689 Move include code in the install file into a function and out of the global scope.
- #255911 node_submit() is not necessary for data integrity check.
- #257059 and #248935, committing a work-around for a Views error that has been fixed but is not in an official release yet.
- Add missing strtotime validation and format help text to textfield date and clarify that it's really a custom input format (which uses strtotime if the custom input fails).
- #256079 make translation of abbreviations easier.
- #256078 Fix typo in popup calendar.
- #255739 Fix backwards validation message when testing that the To date is greater than the From date.
- #248935 Double escaping no longer needed with latest Views dev version, so remove it.
- #251511 Rename function to avoid clash with Diff module.
- #232820 Clean up Date Browser block theme.
- #234073 Make sure empty but required textfield gets a meaningful error message.
- #234021 fix date_repeat timestamp errors.
- #234102 It turns out that we must always force use of the lower level date functions because regular strtotime and mktime can be off by one hour during daylight savings time.
- #219003 Add validation code to date views filter handlers so they will work correctly as exposed filters.
- #234073 Provide a way to make required textfield start out with blank values.
- #239900, #249399 Limit available formats for Date Popup to available formats and hide custom format code which won't work right here.
- Can't use date_make_date within date_part_extract without setting up potential circular reference.
- Format_interval logic was backwards.
- Starting some improvements to Views handling, including new sql function to allow formatting dates in sql.
- #236889 Make sure date_select validation only checks required granularity.
- #234073 Provide a way to make a required date start out with blank values.
- #247749 don't use date popup on system date form, too many potential conflicts.
- #233805 was using wrong value for date type in views filter.
- #242433 adjust timestamps to datetime when creating repeating dates.
- #240980 coder compliance fixups.
- #225738 Add special case handling for year only or year and month only ISO dates.
- #244025 make the jquery calendar code more efficient.

Version 5.2-rc
==============
NOTE! The new version has several new files and is completely re-organized. Empty the module folder completely before adding the contents of the new version. If you don't do that, Drupal may try to use some of the invalid, older files and things will not work correctly. After updating the files on your system, visit the modules page and look for the new Date/Time section and enable the new modules. Then visit update.php to update your database and make sure your site timezone name is correctly set at admin/settings/date-time.

If you use the Token module, be sure to use the latest version of it, too, currently that is the development version. The older version was using the older Date API.

This version should be matched up with the 5.2 version of the Calendar module.

* The Date API now uses PHP 5.2 date functions for better date and timezone handling (and has PHP 4 emulations for those functions so the module will work in PHP4). Although the code will work with PHP 4, it is significantly faster and more efficient under PHP 5.2 or higher, so PHP 5.2 is highly recommended.
* No more need for the adodb date library, historical dates earlier than 1970 and later than 2038 are handled without any external code.
* iCal integration is greatly improved, an iCal parser can parse events, alarms, most types of dates and timezones, duration, repeat rules, and more.
* The Date API creates date elements that can be used by any module, including 'date_select', 'date_textfield', and 'date_timezone'.
* A new Date Timezone module overloads the site and user timezone selectors to allow you to select a timezone name instead of a timezone offset, and that stored name is used to properly adjust date values. It also detects the user's timezone name automatically and updates the user record with that name.
* A new Date Popup module creates a jQuery popup calendar date picker and time picker, and the element is available to other modules as a form type of 'date_popup'.
* The Date module now has lots of new ways to define default values -- you can set a the default to 'blank', 'now', or 'relative', where relative is something like '+90 days'. The To date has a separate default value, which can be the same as the From date or do something different.
* A Date Repeat API module has been added which can be used by any other module. The CCK Date module uses it to allow you to select 'repeating' as a type of multiple date, present the user with a form to select the repeat rules for their date, and then create all the multiple values that match those rules.
